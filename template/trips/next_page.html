{% extends 'index.html' %}
{% block title %}여행 일정 만들기-디테일{% endblock %}
{% block style %}
    <style>
        th {
            text-align: center;
            vertical-align: middle;
        }
    </style>
{% endblock %}

{% block content %}
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=z0aqdob57h"></script>
</head>

<script>
    var map;
    var lat = 37.3595704; // 기본 위도 값
    var long = 127.105399; // 기본 경도 값
    var marker;
    var infowindow;

    function newMap(lat, long, title) {
        var mapOptions = {
            center: new naver.maps.LatLng(lat, long),
            zoom: 18
        };
        map = new naver.maps.Map('map', mapOptions);

        var markerPosition = new naver.maps.LatLng(lat, long);
        marker = new naver.maps.Marker({
            position: markerPosition,
            map: map,
            clickable: true,
            draggable: true,
        });

        infowindow = new naver.maps.InfoWindow({
            content: `<div style="padding:10px;">${title}</div>`
        });
        infowindow.open(map, marker);
    }

    function loca(y, x, title){
        var lat, long;
        
        if (y == 0) {                
            lat = 37.3595704;
            long = 127.105399;
        } else {                
            lat = parseFloat(y) / 1e7;
            long = parseFloat(x) / 1e7;   
        }
        newMap(lat, long, title);
    }
</script>

<div class="container" style="margin-top: 0px;">
    <div class="text-center ml-4 mb-5">
        <h3 style="font-weight: bold;">{{ head }}</h3>
    </div>

    <div class="row">
        <div class="col">
            <form method='post'> {% csrf_token %}
                <table class="table table-bordered border-secondary text-center" style="width: 90%;>
                <thead class="table-secondary border-secondary">
                <tr>
                    <th colspan="2" class="text-uppercase">Add-Trip</th>
                </tr>
                </thead>
                <tr>
                    <th>Day</th>
                    <td><input type="number" class="form-control" id="quantity" 
                    name="day" min="1" max={{ day }} step="1"></td>
                </tr>
                <tr>
                    <th>Destination</th>
                    <td>
                        <select class="form-select" name='d_id'>
                        <option selected>내 장소에서 선택하기</option>
                        {% for i in destination %}
                        <option value="{{ i.id }}">{{ i.name }}</option>
                        {% endfor %}
                        </select>
                    </td>
                </tr>
                <tr>
                    <th>Expense</th>
                    <td><input type="text" class="form-control" name='expense'></td>
                </tr>
                <tr>
                    <th>context</th>
                    <td><input type="text" class="form-control" name='context'></td>
                </tr>
                <tr>
                    <td colspan="2">
                        <input type="submit" class="btn btn-warning" 
                            style="width:120px" value="ADD"
                                onclick="document.location.href='/'">
                        <input type="reset" class="btn outline-danger" 
                            style="width:120px" value="RESET">
                    </td>
                </tr>
                </table>
            </form> 
            <button type="button" class="btn btn-light" style="width:400px"
            onclick="location.href='/destinations/{{trip_id}}'">장소추가</button>           
        </div>

        <div class="col">
            <table class="table border-primary text-center table-hover" style="width:100%;">
                <thead class="table-secondary">
                <tr>
                    <th class="text-uppercase">Trip-Detail</th>
                </tr> 
                </thead>
                <tbody>
                {% for day in trip_dates %}                
                    <tr class="table-secondary">
                        <td style="font-weight: bold;">{{ day }} DAY</td>
                    </tr>
                    {% for i in tripdetail %}  
                        {% if i.day == day %}    
                        <tr class="table table-border-secondary">
                            <td>
                                <ul class="list-group">                        
                                    <a>{{ i.destination }}</a>                    
                                </ul>
                            </td>       
                        </tr>
                        {% endif %}
                    {% endfor %}
                {% endfor %}  
                </tbody>              
            </table>

        </div>

    </div>
    <div class="row">
        <table class="table table-bordered border-secondary text-center mt-5" style="width:45%;">                    
            <tr><td>지도</td></tr>
            <tr>
            <td>
                <div id="map" style="width:100%;height:400px;"></div>
                <script>
                    newMap(lat, long, "기본 위치")
                </script>
            </td>
            </tr>
        </table>
    </div>

</div>

{% endblock %}
